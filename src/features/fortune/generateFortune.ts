export type Grade =
  | "초대박" // 최상
  | "대박"
  | "좋음"
  | "보통"
  | "주의"
  | "조심"
  | "위험"; // 최하

type NonEmptyArray<T> = readonly [T, ...T[]];

// 안전 pick
function pick<T>(rng: () => number, arr: NonEmptyArray<T>): T {
  const idx = Math.floor(rng() * arr.length) % arr.length;
  return arr[idx] ?? arr[0];
}

/* ── 결정론 RNG ── */
function xmur3(str: string) {
  let h = 1779033703 ^ str.length;
  for (let i = 0; i < str.length; i++) {
    h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
    h = (h << 13) | (h >>> 19);
  }
  return function () {
    h = Math.imul(h ^ (h >>> 16), 2246822507);
    h = Math.imul(h ^ (h >>> 13), 3266489909);
    return (h ^= h >>> 16) >>> 0;
  };
}
function mulberry32(a: number) {
  return function () {
    let t = (a += 0x6d2b79f5);
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}
function seededRandom(seedStr: string) {
  const seed = xmur3(seedStr)();
  return mulberry32(seed);
}

/* ── 데이터 ── */
export const GRADES = [
  "초대박",
  "대박",
  "좋음",
  "보통",
  "주의",
  "조심",
  "위험",
] as const;

const TITLE_POOL: Record<Grade, NonEmptyArray<string>> = {
  초대박: [
    "별의 축복",
    "천운 개시",
    "빛의 개벽",
    "행운 폭발",
    "우주의 미소",
    "신의 한 수",
    "금빛 파도",
    "찬스 오로라",
  ],
  대박: [
    "행운의 바람",
    "골든 타이밍",
    "오늘은 주인공",
    "운명의 편지",
    "물 흐르듯 술술",
    "찬스 포착",
    "빛나는 하루",
    "시작이 반",
  ],
  좋음: [
    "잔잔한 상승세",
    "기분 좋은 예감",
    "따뜻한 순간",
    "리듬을 타는 날",
    "작은 행운",
    "밝은 여운",
    "햇살 한 줌",
    "맑은 파장",
  ],
  보통: [
    "루틴 유지",
    "평화로운 리듬",
    "꾸준히 한 걸음",
    "무난무난",
    "잔잔한 호수",
    "담담한 온도",
    "균형의 날",
    "기본기 탄탄",
  ],
  주의: [
    "속도 조절",
    "한 템포 쉬어가기",
    "딱 한 번 더 확인",
    "과속 금지",
    "유턴도 전략",
    "조심조심",
    "코너 돌듯이",
    "버퍼링 권장",
  ],
  조심: [
    "안전 제일",
    "컨디션 관리",
    "휴식이 답",
    "마음 가다듬기",
    "리스크 회피",
    "무리 금지",
    "잠깐 멈춤",
    "재정비의 날",
  ],
  위험: [
    "폭풍 전야",
    "리스크 경보",
    "방어 모드",
    "정비가 필요",
    "경고등 점등",
    "위험지대",
    "발걸음 천천히",
    "막판 변수",
  ],
};

const SUMMARY_POOL: Record<Grade, NonEmptyArray<string>> = {
  초대박: [
    "놓치기 아까운 빅찬스! 과감히 시도해도 좋아요.",
    "뛰어들면 물이 갈라집니다. 중요한 결정을 밀어도 OK.",
    "작은 선택이 큰 파문을 만드는 날.",
    // +5
    "전화 한 통, DM 한 줄이 판도를 바꿉니다.",
    "한 번의 승부수—결과가 빠르게 따라옵니다.",
    "당신의 이름이 회자되는 날. 존재감을 밀어붙이세요.",
    "기대 이상의 제안이 들어옵니다. 먼저 조건을 제시하세요.",
    "타이밍이 기가 막혀요. 준비한 걸 꺼내기만 하면 됩니다.",
  ],
  대박: [
    "행운의 바람이 붑니다. 기회를 꼭 붙잡아 보세요!",
    "타이밍이 빛나요. 마음먹은 바를 밀어붙여도 좋습니다.",
    "정면승부가 통하는 날이에요. 선점이 관건!",
    "작은 이득이 연쇄적으로 이어집니다.",
    "도움 요청에 답이 빨리 옵니다. 협업하기 좋은 날입니다.",
    "눈치 보기보다 실행이 답입니다. 시작하면 반은 끝나요.",
    "낯선 제안도 검토해볼 만한 가치가 있어요.",
    "실수해도 회복력이 크니 과감하게 움직여도 됩니다.",
    "평소에 미뤄둔 일이 술술 풀립니다.",
    "작은 투자나 시도가 의외의 결실로 돌아옵니다.",
    "뜻밖의 만남이 좋은 기회로 이어질 수 있어요.",
  ],

  좋음: [
    "기분 좋은 흐름이 이어지는 하루예요.",
    "자신감이 편안하게 묻어납니다.",
    "작지만 확실한 성취가 쌓여갑니다.",
    "컨디션이 안정적이에요. 계획한 만큼만 해도 충분합니다.",
    "새로운 루틴을 시작하기 좋은 날입니다.",
    "피드백이 자연스럽게 받아들여집니다.",
    "정리·정돈이 효율을 높여줍니다.",
    "대화가 술술 풀려요. 공감이 열쇠입니다.",
    "소소한 칭찬이 하루를 더 밝게 만듭니다.",
    "작은 배려가 큰 만족으로 돌아옵니다.",
    "일상에서 작은 즐거움을 발견하게 됩니다.",
  ],
  보통: [
    "평소 루틴을 지키는 것만으로도 충분히 안정적인 하루예요.",
    "큰 성과보다 작은 일들을 차근차근 마무리해보세요.",
    "서두르지 않으면 실수도 줄고 마음도 편해집니다.",
    "밀린 일을 정리하기에 딱 좋은 날이에요.",
    "짧은 휴식과 스트레칭이 업무 효율을 지켜줍니다.",
    "작은 확인이나 점검이 불필요한 문제를 막아줍니다.",
    "새로운 시도보다 어제 하던 걸 조금 더 다듬어 보세요.",
    "일정을 욕심내지 말고 오늘 할 수 있는 만큼만 해도 충분합니다.",
    "주변 정리를 하면 마음도 가볍게 정돈돼요.",
    "오늘은 무난하게 흘러가는 게 가장 큰 장점입니다.",
    "큰 기대나 걱정보다, 있는 그대로의 리듬을 즐기세요.",
  ],

  주의: [
    "한 템포만 늦춰도 더 잘 풀립니다.",
    "체크리스트가 방패가 됩니다. 두 번 확인하세요.",
    "돌다리도 두드려 보고 건너는 게 안전합니다.",
    "대충의 기억에 기대지 말고 기록을 확인하세요.",
    "감정적으로 판단하지 말고, 수치나 사실로 점검하세요.",
    "불필요한 약속은 미루는 게 상책입니다.",
    "추가 비용과 시간을 넉넉히 잡으세요.",
    "메일·메시지는 보내기 전에 꼭 한 번 더 읽어보세요.",
    "급히 결정한 일에 실수가 많습니다. 시간을 두세요.",
    "오늘은 무리하지 말고 안전한 선택을 우선하세요.",
    "남의 말을 곧이곧대로 믿지 말고 스스로 검증하세요.",
  ],

  조심: [
    "무리하지 말고 휴식이 먼저예요.",
    "오늘은 보수적으로. 체력과 감정 관리에 집중하세요.",
    "큰일은 내일로 미루고 컨디션부터 챙기세요.",
    "결정은 내일의 나에게 맡기고, 오늘은 자료만 모으세요.",
    "안 되는 이유를 찾기보다 멈출 이유를 먼저 생각하세요.",
    "몸의 신호를 무시하지 마세요. 짧게라도 꼭 쉬세요.",
    "소음과 방해 요소를 줄이면 사고가 줄어듭니다.",
    "에너지가 떨어지는 시간대에는 단순 작업만 하세요.",
    "새로운 시도는 오늘 피하세요. 반복·유지에 집중하세요.",
    "갈등이 보이면 직접 나서지 말고 거리를 두세요.",
    "오늘은 '멈춤'이 최고의 전략입니다.",
  ],
  위험: [
    "지금은 방어에 집중하세요. 중요한 결정은 하루 미루는 게 안전합니다.",
    "변수가 많은 날, 작은 실수도 크게 번질 수 있어요.",
    "피해가기와 버티기가 최고의 전략입니다.",
    "말을 줄이고 듣는 데 집중하세요. 말수가 적을수록 안전합니다.",
    "서명·결제·전송은 보류하세요. 오늘은 검토가 먼저입니다.",
    "감정을 급하게 끌어올리지 말고, 호흡을 길게 가져가세요.",
    "일정을 줄이고 정말 중요한 것만 남기세요.",
    "분산하지 말고 차단하세요. 알림과 방해 요소를 끄는 게 좋습니다.",
    "새로운 계약·약속은 피하세요. 보류가 답입니다.",
    "잠깐의 고집이 큰 손실로 이어질 수 있습니다. 한 번 더 멈추세요.",
    "오늘은 '지나침'보다 '멈춤'이 훨씬 이득입니다.",
  ],
};

const LOVE_MSGS: NonEmptyArray<string> = [
  "말로 풀기 어려운 감정은, 그냥 조용히 옆에 있어 주는 것만으로도 전해집니다.",
  "서운함을 표현할 땐 ‘너 때문’보다 ‘내가 이렇게 느꼈어’로 시작하세요.",
  "대화가 막히는 순간, 침묵도 관계의 한 부분임을 인정해 보세요.",
  "질투가 올라올 땐 상대를 다그치기보다 내 불안을 솔직히 드러내는 게 해답입니다.",
  "서로의 차이를 설득하려 하지 말고, 그 간격 자체를 존중해 보세요.",
  "작은 서운함이 쌓일 때는 대화보다도 먼저 스스로 감정을 정리할 시간이 필요합니다.",
  "상대방의 말투에 담긴 맥락을 읽으려는 노력이 사랑의 깊이를 만듭니다.",
  "연락이 뜸한 날은 무심함보다 지쳐 있다는 신호일 수 있어요. 짐작보다 질문을 택하세요.",
  "사랑을 오래 가게 하는 건 설레는 순간이 아니라, 불편한 감정을 안전하게 꺼낼 수 있는 힘입니다.",
  "감정의 온도가 다를 땐 속도를 맞추는 게 아니라, 기다려 줄 줄 아는 게 중요합니다.",
  "사소한 다툼은 '누가 옳은가'보다 '어떻게 다시 연결될까'에 집중해야 풀립니다.",
  "상대의 불안이 내 잘못이 아닐 수도 있다는 걸 인정하는 순간, 관계가 훨씬 가벼워집니다.",
  "사랑은 언제나 ‘이해’보다 ‘이해하려는 태도’에서 힘을 얻습니다.",
  "말하지 않아도 알 거라는 기대는 내려놓고, 말하지 않으면 모를 수 있다는 걸 기억하세요.",
  "가끔은 ‘괜찮아, 천천히 말해도 돼’라는 한마디가 사랑을 더 단단하게 만듭니다.",

  // ✨ 긍정적인 추가 5개
  "사랑은 결국 서로의 하루를 밝히는 작은 습관에서 자라납니다.",
  "예상치 못한 순간에 웃음을 나눌 때, 관계의 온도가 높아집니다.",
  "상대의 눈을 바라보는 짧은 시간에, 긴 대화보다 깊은 위로가 담깁니다.",
  "함께하는 침묵조차 편안하다면, 그건 이미 큰 사랑의 증거입니다.",
  "사랑은 거창한 이벤트보다도 매일의 따뜻한 반복에서 가장 빛납니다.",
];

const WORK_MSGS: NonEmptyArray<string> = [
  // ⚡ 우선순위·집중
  "해야 할 일 세 가지에 집중하세요—나머지는 미뤄도 괜찮습니다.",
  "작은 성과라도 눈에 보이게 기록하면 동력이 생깁니다.",
  "완벽 대신 ‘보낼 수 있는 수준’을 목표로 하세요.",
  "30분 몰입 + 5분 휴식, 리듬이 쌓이면 오래 갑니다.",
  "기록은 기억보다 오래 가고, 감정보다 공정합니다.",

  // 🤝 관계·협업
  "동료가 이해하지 못한다면 설명을 절반으로 줄여보세요—핵심만 남습니다.",
  "피드백 기한을 먼저 제시하면, 서로가 편해집니다.",
  "회의에서 합의 못 한 건, 말하지 않은 감정이 원인일 때가 많습니다.",
  "내 아이디어가 채택되지 않아도 팀이 잘 된다면, 그건 내 성과이기도 합니다.",
  "칭찬 한마디가 KPI보다 오래 기억됩니다.",

  // 🔄 균형·감정
  "오늘의 실패는 내일의 데이터입니다. 부끄러움보다 배움이 남습니다.",
  "리더의 기대와 팀원의 피로 사이에서 균형을 찾는 게 진짜 성과 관리입니다.",
  "갈등을 피하기보다, 왜 다르게 보는지 묻는 게 해결의 시작입니다.",
  "내가 틀릴 수도 있음을 인정하는 순간, 협업의 문이 열립니다.",
  "페이스 유지가 가장 빠른 지름길입니다.",

  // 🧩 실행·조율
  "‘지금 당장 10분’만 투자해도 관성이 붙습니다.",
  "템플릿을 만드는 데 쓴 1시간은, 내일의 3시간을 아껴줍니다.",
  "디테일 한 줄이 프로젝트 전체를 좌우합니다.",
  "메일·메신저는 하루 두 번만 몰아서 처리하세요—집중력을 지키는 방법입니다.",
  "일의 정의를 다시 확인하세요. ‘왜 이걸 하는가’를 알면 답답함이 줄어듭니다.",
];

const HEALTH_MSGS: NonEmptyArray<string> = [
  // 🧘 기본 루틴
  "목과 어깨를 30초만 풀어줘도 피로가 확 달라집니다.",
  "물 한 컵과 함께 자리에서 일어나 기지개를 켜세요.",
  "햇볕 5분만 쬐어도 뇌가 깨어나고 기분이 밝아집니다.",
  "늦은 카페인은 내일의 수면을 훔쳐갑니다.",
  "가벼운 근력 운동 10분이면 하루 전체가 가벼워집니다.",

  // 🍵 회복 & 휴식
  "따뜻한 차 한 잔은 몸보다 마음을 먼저 진정시킵니다.",
  "퇴근 후 샤워가 수면 루틴의 시작 신호가 됩니다.",
  "저녁에 소금과 양념을 줄이면 숙면 확률이 올라갑니다.",
  "스트레스가 몰려올 땐 복식호흡 1분으로 심박을 낮춰보세요.",
  "눈을 자주 감고 멀리 바라보는 습관이 집중력을 지켜줍니다.",

  // 🚶‍♀️ 생활 속 실천
  "식사 전 짧은 산책은 소화와 혈당 조절에 도움이 됩니다.",
  "앉았다 일어나기 10회—작지만 순환이 달라집니다.",
  "간식은 과자 대신 과일 한 조각으로 바꿔보세요.",
  "앱 알림을 줄이는 것만으로도 심장이 차분해집니다.",
  "자정 이전에 불을 끄는 습관이 건강을 지켜줍니다.",
];

const COLORS: NonEmptyArray<string> = [
  "에메랄드",
  "살구",
  "네이비",
  "코랄",
  "올리브",
  "라벤더",
  "아이보리",
  "민트",
  "보르도",
  "라임",
  "하늘",
  "체리",
  "샌드",
  "스틸",
  "버터",
  "청록",
  "라일락",
  "머스타드",
  "차콜",
  "피치",
  "딥그린",
  "플럼",
  "연보라",
  "버건디",
];

const ITEMS: NonEmptyArray<string> = [
  "텀블러",
  "손수건",
  "이어폰",
  "책갈피",
  "스티커",
  "펜",
  "캔들",
  "립밤",
  "노트",
  "키링",
  "헤어밴드",
  "슬리퍼",
  "카드지갑",
  "키보드 키캡",
  "마그넷",
  "디퓨저",
  "손난로",
  "스테인리스 빨대",
  "차 티백",
  "휴대용 거울",
];

// 재미 요소: 오늘의 키워드
const KEYWORDS: NonEmptyArray<string> = [
  "시작",
  "정리",
  "히든찬스",
  "균형",
  "집중",
  "회복",
  "대화",
  "성장",
  "실험",
  "타이밍",
  "자신감",
  "단호함",
  "유연함",
  "휴식",
  "관찰",

  "협업",
  "루틴",
  "확장",
  "절제",
  "재정비",
  "도전", // 새로운 국면에 뛰어드는 용기
  "연결", // 관계·네트워크 확장
  "안정", // 마음·환경을 단단히
  "전환", // 흐름을 바꾸는 시점
  "몰입", // 깊게 빠져들어 성과를 내는 힘
];

export type Fortune = {
  title: string;
  summary: string;
  love: string;
  work: string;
  health: string;
  luckyColor: string;
  luckyNumber: number;
  luckyItem: string;
  grade: Grade;
  keywords: string[];
};

export function generateFortune(seedKey: string): Fortune {
  const rng = seededRandom(seedKey);

  // 등급 가중치: 초대박/위험은 낮은 확률
  const bag: Grade[] = [
    "초대박",
    "대박",
    "대박",
    "좋음",
    "좋음",
    "좋음",
    "보통",
    "보통",
    "보통",
    "보통",
    "주의",
    "주의",
    "조심",
    "위험",
  ];
  const grade = pick(rng, bag as unknown as NonEmptyArray<Grade>);

  return {
    title: pick(rng, TITLE_POOL[grade]),
    summary: pick(rng, SUMMARY_POOL[grade]),
    love: pick(rng, LOVE_MSGS),
    work: pick(rng, WORK_MSGS),
    health: pick(rng, HEALTH_MSGS),
    luckyColor: pick(rng, COLORS),
    luckyNumber: Math.floor(rng() * 44) + 1,
    luckyItem: pick(rng, ITEMS),
    grade,
    keywords: [pick(rng, KEYWORDS), pick(rng, KEYWORDS)],
  };
}
